\documentclass[../main.tex]{subfiles} % 需要pdf封面

\begin{document}

由已有的生活经验可知，
进入楼层时，
们正常被打开，
等待一段时间之后关闭门，
然后电梯准备运行，
若关门时开门键按下，
门被打开，
按下关门键则只是修改了等待时间，
安全起见，
门不会立刻关闭。
根据以上经验
开关门分为%
\cref{fig:door_control}
所示的几个阶段
\begin{enumerate}
  \item 到达阶段:
    由电梯到达时间$t_a$开始,
    该阶段传感器检查安全状况并等待开门，
    项目中只是计时
  \item 开门阶段:
    从第一次开门时刻$t_{o_1}$到最后一次开门时刻$t_{o_4}$为止，
    具体分为几个时间点需要知道下层的物理实现，
    本项目使用led的四个灯，
    故简单划分为四个阶段
  \item 载客等待:
    将等待时间划分为两个部分有利于关门键的响应
  \item 最小等待:
    电梯的设计中,关门键按下之后直接进入最小等待阶段
    \upcite{close-button},
    同时利用传感器做安全检测，
    确定安全之后关门
  \item 关门阶段:
    对应开门阶段
  \item 启动阶段:
    关门后一段时间不在响应开门请求，
    准备启动，
    在这之前都会响应开门，
    有的电梯可能在关门阶段后还有一段时间会响应开门请求，
    这里直接近似为关门之后不在响应。
\end{enumerate}

\begin{figure}[H]
  \centering
  \def\svgwidth{\linewidth}
  \input{figures/door_control.pdf_tex}
  \caption{开门控制的逻辑示意图}
  \label{fig:door_control}
\end{figure}

% 由于每次刷新都检查请求和开门键，
% 开门键按下时钟调到到达之后的计时状态，
% 所以开门键和请求到达是等效的，
% 在生活中观察可以得出，
% 在电梯外部的楼层呼叫也有内部开门键的效果
\cref{fig:door_control}展示了简单的开关门目录，
现代电梯的开关门还与传感器有关，
关门时间$t_{c_1}$还需要传感器判断，
防止乘客被们伤害，
同时也在此时检查超载，
因为芯片性能和外围设备的限制，
这里只是做一些定时操作进行模拟。
在项目中实现的计时功能均使用宏定义，
模拟各个阶段的时间段
实际应用时可以直接修改设置来完成实际应用的等待时间和启动时间.
也可以对时间设置进行调整，
实现中按下开门键直接重新开门并计时，
这样最大限度的减少系统运行开销，
电梯重新计时也给了最后进入的乘客充足的时间，
模拟中只展示了基本原理，
具体的合适时间配置还需要结合实际修改时间段设置。

\end{document}
